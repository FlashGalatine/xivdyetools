# [BUG-002]: Cross-Tab Session Invalidation Missing

## Severity
LOW

## Type
State Management Issue

## Location
- File: `apps/web-app/src/services/auth-service.ts`

## Description
The web app stores JWT tokens in `localStorage`, which is shared across all tabs of the same origin. When a user logs out in one tab, the token is removed from localStorage, but other open tabs are not notified of the logout. These tabs continue operating with their in-memory copy of the authentication state until they next check `isAuthenticated()`.

## Reproduction Scenario
1. User opens the app in Tab A and Tab B
2. User logs out in Tab A (localStorage is cleared)
3. Tab B still shows the user as logged in (in-memory auth state)
4. Tab B makes an API call with the now-invalidated token
5. API returns 401, but Tab B shows a confusing error instead of redirecting to login

## Evidence
```typescript
// Logout in auth-service.ts:
localStorage.removeItem('jwt_token');
localStorage.removeItem('jwt_expires_at');
// No StorageEvent listener in other tabs
```

## Suggested Fix
```typescript
// Add StorageEvent listener for cross-tab logout
window.addEventListener('storage', (event) => {
  if (event.key === 'jwt_token' && event.newValue === null) {
    // Token was removed in another tab - trigger logout in this tab
    this.handleLogout();
  }
});

---

## Resolution Note (2026-02-19) — Fixed in web-app 4.1.7

`apps/web-app/src/services/auth-service.ts` `initialize()`: Added a `window.addEventListener('storage', ...)`
listener registered once per page load. The listener watches for changes to `TOKEN_STORAGE_KEY`:

- If the token is **removed** in another tab and the current tab is authenticated → clears state and notifies listeners
- If the token is **set** in another tab and the current tab is not authenticated → loads the new session state

Because `StorageEvent` only fires on tabs **other than the one that made the change**, there is no
risk of the originating tab's logout being double-processed.
```

## Why It's Hidden
- Most users don't have multiple tabs open simultaneously
- The bug only causes a brief inconsistency until the next auth check
- API calls would fail gracefully with 401, triggering re-authentication
