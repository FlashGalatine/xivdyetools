# BUG-001: Double XML Escaping in SVG Generators

## Severity
MEDIUM

## Type
Logic Error

## Location
- Files: `packages/svg/src/contrast-matrix.ts`, `packages/svg/src/palette-grid.ts`, `packages/svg/src/preset-swatch.ts`, `packages/svg/src/random-dyes-grid.ts`, `packages/svg/src/budget-comparison.ts`, `packages/svg/src/dye-info-card.ts`
- Function: Multiple callers of `text()`

## Description
The `text()` helper in `base.ts` already calls `escapeXml(content)` on all content passed to it. However, 10+ callsites in various SVG generators **also** wrap content in `escapeXml()` before passing it to `text()`, causing double escaping. Characters like `&` become `&amp;amp;` instead of `&amp;`.

## Evidence
```typescript
// base.ts — text() already escapes
export function text(x, y, content, options) {
  return `<text ${attrs.join(' ')}>${escapeXml(content)}</text>`;
}

// contrast-matrix.ts — caller ALSO escapes (double escape!)
const displayName = truncateName(dye.name, 12);
text(x, y + 16, escapeXml(displayName), { ... });

// preset-swatch.ts — same issue
text(width / 2, PADDING + 24, `${categoryDisplay.icon} ${escapeXml(name)}`, ...);
text(width / 2, PADDING + 50, escapeXml(truncatedDesc), ...);
text(x + width / 2, labelY, escapeXml(truncatedName), ...);
```

Affected locations:
- `contrast-matrix.ts` L189
- `palette-grid.ts` L267
- `preset-swatch.ts` L145, L159, L215, L245
- `random-dyes-grid.ts` L182
- `budget-comparison.ts` L284, L292, L393, L553

## Reproduction Scenario
Any dye name containing `&`, `<`, `>`, `'`, or `"` would display with corrupted entities in generated SVG images. For example, a hypothetical dye name "Fire & Ice" would render as "Fire &amp;amp; Ice" instead of "Fire & Ice".

## Suggested Fix
Remove the outer `escapeXml()` call from all callers of `text()`:

```typescript
// ✅ Correct — text() handles escaping internally
text(x, y + 16, displayName, { ... });
text(width / 2, PADDING + 24, `${categoryDisplay.icon} ${name}`, ...);
```

## Why It's Hidden
Current FFXIV dye names don't contain any XML-special characters, so the double escaping produces no visible difference. The bug would only manifest with future dye names containing special characters, or with user-provided preset names containing `&`.
