# BUG-008: `findClosestDye` May Miss Perceptually Close Matches

## Severity
MEDIUM

## Type
Algorithmic Edge Case

## Location
- File: `packages/core/src/services/dye/DyeSearch.ts`
- Line(s): ~171-200
- Function: `findClosestDye()`

## Description
For non-RGB matching methods (OKLAB, CIEDE2000), the k-d tree uses a fixed RGB threshold of 100 units to find candidates, which are then re-ranked by perceptual distance. Colors that are perceptually similar but distant in RGB space (e.g., dark blues vs. dark purples) may be outside the 100-unit RGB threshold and get missed entirely. The fallback only picks the single nearest RGB neighbor.

## Evidence
```typescript
const rgbCandidateThreshold = 100;
const candidateResults = kdTree.pointsWithinDistance(
  targetPoint, rgbCandidateThreshold, ...
);
// ...
// Fallback: nearest single RGB neighbor
const nearest = kdTree.nearestNeighbor(targetPoint, ...);
```

## Reproduction Scenario
1. User enters a dark purple color (#2A1B3D)
2. K-d tree in RGB space finds candidates within 100 RGB units
3. A dark blue dye that is perceptually closer in OKLAB space but >100 RGB units away is missed
4. User gets a suboptimal match

## Suggested Fix
- Build a secondary k-d tree in OKLAB space using pre-computed LAB/OKLAB values
- Or, increase the threshold dynamically based on matching method
- Or, fall back to a full linear scan when the candidate set is smaller than 5 entries

## Why It's Hidden
With 136 dyes covering a wide color space, the 100-unit threshold catches most candidates. The miss only occurs for colors in under-represented areas of the dye palette where perceptual distances diverge significantly from RGB distances.
