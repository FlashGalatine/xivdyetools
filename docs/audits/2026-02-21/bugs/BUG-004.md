# BUG-004: KV Backend `checkOnly()` Incorrectly Subtracts 1 from Remaining

## Severity
MEDIUM

## Type
Logic Error — Off-by-One

## Location
- File: `packages/rate-limiter/src/backends/kv.ts`
- Line(s): ~130-148
- Function: `checkOnly()`

## Description
The `checkOnly()` method subtracts 1 from the `remaining` count even though it's a read-only check that doesn't increment the counter. This causes callers to see `remaining: 0` when they actually still have 1 request left, leading to premature rate-limit avoidance in clients that check before sending.

## Evidence
```typescript
// kv.ts — checkOnly()
// New window case:
return {
  allowed: true,
  remaining: effectiveLimit - 1,  // ← Subtracts 1, but nothing was incremented
  ...
};

// Existing window case:
const remaining = Math.max(0, effectiveLimit - entry.count - 1);  // ← Same issue
```

Contrast with the expected behavior: `checkOnly()` should report how many requests remain **without** consuming one.

## Reproduction Scenario
1. Rate limit is set to 5 requests/minute
2. User has made 4 requests
3. `checkOnly()` returns `remaining: 0` (5 - 4 - 1 = 0)
4. Client thinks it's rate limited and stops sending
5. But the user actually had 1 request remaining

## Suggested Fix
Remove the `-1` from `checkOnly()`:

```typescript
// New window case:
return {
  allowed: true,
  remaining: effectiveLimit,
};

// Existing window case:
const remaining = Math.max(0, effectiveLimit - entry.count);
```

The `-1` adjustment only makes sense in `check()` where an increment follows.

## Why It's Hidden
The `check()` method (which increments) correctly reports remaining, so the off-by-one only manifests when using the read-only `checkOnly()` path. Most consumers use `check()` directly.
